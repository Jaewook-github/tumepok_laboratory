# 주식시간외호가 (0E)

## TR 정보
- **TR 코드**: 0E
- **TR 명**: 주식시간외호가
- **타입**: WebSocket 실시간 데이터
- **용도**: 주식 시간외 호가 실시간 통신

## WebSocket 연결 및 실시간 데이터 수신

```python
import asyncio 
import websockets
import json

# socket 정보
# SOCKET_URL = 'wss://mockapi.kiwoom.com:10000/api/dostk/websocket'  # 모의투자 접속 URL
SOCKET_URL = 'wss://api.kiwoom.com:10000/api/dostk/websocket'  # 접속 URL
ACCESS_TOKEN = '사용자 AccessToken'  # 고객 Access Token

class WebSocketClient:
	def __init__(self, uri):
		self.uri = uri
		self.websocket = None
		self.connected = False
		self.keep_running = True

	async def connect(self):
		try:
			self.websocket = await websockets.connect(self.uri)
			self.connected = True
			print("서버와 연결을 시도 중입니다.")
			
			param = {
				'trnm': 'LOGIN',
				'token': ACCESS_TOKEN
			}
			
			await self.send_message(message=param)
		except Exception as e:
			print(f'Connection error: {e}')
			self.connected = False

	async def send_message(self, message):
		if not self.connected:
			await self.connect()
		if self.connected:
			if not isinstance(message, str):
				message = json.dumps(message)
			await self.websocket.send(message)

	async def receive_messages(self):
		while self.keep_running:
			try:
				response = json.loads(await self.websocket.recv())
				if response.get('trnm') == 'LOGIN':
					if response.get('return_code') != 0:
						print('로그인 실패:', response.get('return_msg'))
						await self.disconnect()
					else:
						print('로그인 성공')
				elif response.get('trnm') == 'PING':
					await self.send_message(response)
				
				if response.get('trnm') != 'PING':
					print(f'실시간 데이터 수신: {response}')
			except websockets.ConnectionClosed:
				self.connected = False
				break

	async def run(self):
		await self.connect()
		await self.receive_messages()

	async def disconnect(self):
		self.keep_running = False
		if self.connected and self.websocket:
			await self.websocket.close()
			self.connected = False

async def main():
	websocket_client = WebSocketClient(SOCKET_URL)
	receive_task = asyncio.create_task(websocket_client.run())

	await asyncio.sleep(1)
	await websocket_client.send_message({ 
		'trnm': 'REG',
		'grp_no': '1',
		'refresh': '1',
		'data': [{
			'item': ['005930'],
			'type': ['0E'],
		}]
	})

	await receive_task

if __name__ == '__main__':
	asyncio.run(main())
```

## 요청/응답 사양

표준 WebSocket 실시간 등록/해지 프로토콜을 사용하며, 0E 타입으로 시간외 호가 데이터를 실시간 수신합니다.